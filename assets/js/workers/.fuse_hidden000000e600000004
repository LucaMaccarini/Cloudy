function timeConverter(UNIX_timestamp){
    var a = new Date(UNIX_timestamp * 1000);
    var days = ['Domenica', 'Lunedì', 'Martedì', 'Mercoledì', 'Giovedì', 'Venerdì', 'Sabato'];
    var months = ['Gen','Feb','Mar','Apr','Mag','Giu','Lug','Ago','Set','Ott','Nov','Dic'];
    var dayNumber = a.getDate();
    var dayName = days[a.getDay()];
    var month = months[a.getMonth()];
    var hour = a.getHours();
    return {nome_giorno: dayName, giorno: dayNumber, mese: month, ora: hour};       
};

self.addEventListener('message', async function(e){
    //{giorno, [{ora, valori}]}
    var giorno_dati_meteo = new Array();
    var ora_dati_meteo = new Array();

    var data = timeConverter(e.data[0].dt);
    ora_dati_meteo.push(
        {
            ora: data.ora, 
            temp: e.data[0].main.temp, 
            temp_percepita: e.data[0].main.feels_like, 
            temp_min: e.data[0].main.temp_min,
            temp_max: e.data[0].main.temp_max,            
            umidita: e.data[0].main.humidity,
            descrizione_tempo: e.data[0].weather.description,
            velocita_vento: e.data[0].wind.speed,        
        }
    )

    
    for(let i=1; i<e.data.length; i++){
        let current_data=timeConverter(e.data[i].dt)

        if(data.giorno == current_data.giorno){

            ora_dati_meteo.push(
                {
                    ora: current_data.ora, 
                    temp: e.data[i].main.temp, 
                    temp_percepita: e.data[i].main.feels_like, 
                    temp_min: e.data[i].main.temp_min,
                    temp_max: e.data[i].main.temp_max,            
                    umidita: e.data[i].main.humidity,
                    descrizione_tempo: e.data[i].weather[0].description,
                    velocita_vento: e.data[i].wind.speed,        
                }
            )

        }else{
            giorno_dati_meteo.push({giorno: data.giorno, dati_meteo: ora_dati_meteo});
            ora_dati_meteo = [];
            ora_dati_meteo.push(
                {
                    ora: data.ora, 
                    temp: e.data[i].main.temp, 
                    temp_percepita: e.data[i].main.feels_like, 
                    temp_min: e.data[i].main.temp_min,
                    temp_max: e.data[i].main.temp_max,            
                    umidita: e.data[i].main.humidity,
                    descrizione_tempo: e.data[i].weather[0].description,
                    velocita_vento: e.data[i].wind.speed,        
                }
            )
            data = timeConverter(e.data[i].dt);
        }
    }

    self.postMessage(giorno_dati_meteo);
})